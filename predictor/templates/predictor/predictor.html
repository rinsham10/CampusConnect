<!-- templates/predictor/predict.html (FINAL VERSION) -->

{% extends "users/career_base.html" %}
{% load static %}

{% block career_content %}

<!-- These styles are adapted from your original predictor for consistency -->
<style>
    .predictor-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 2.5rem;
        background-color: #fff;
        border: 1px solid #e9e9f1;
        border-radius: 0.75rem;
    }
    .result-box {
        margin-top: 2rem;
        padding: 1.5rem;
        border-radius: 0.5rem;
        text-align: left;
    }
    .prediction-text {
        font-size: 1.5rem;
        font-weight: 600;
        text-align: center;
        margin-bottom: 1rem;
    }
    .recommendations ul {
        padding-left: 20px;
        margin-top: 10px;
    }
    .recommendations li {
        margin-bottom: 8px;
    }
    .alert-success-custom {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    .alert-warning-custom {
        background-color: #edf1ff; /* Your custom color */
        color: #000000;
        border: 1px solid #ffffff;
    }
</style>

<div class="career-main-content">
    <div class="predictor-container">
        <div class="text-center">
            <h1 class="mb-3">Placement Prediction</h1>
            <p>Fill in your details to get a personalized placement prediction.</p>
        </div>
        <hr class="my-4">

        <form method="post">
            {% csrf_token %}
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="cgpa" class="form-label"><b>PG CGPA (out of 10):</b></label>
                    <!-- MODIFIED: Added value="{{ user_inputs.cgpa }}" -->
                    <input type="number" step="0.01" name="cgpa" id="cgpa-input" class="form-control" placeholder="e.g., 8.5" required value="{{ user_inputs.cgpa }}">
                    <p id="cgpa-error" style="color: red; display: none; margin-top: 5px;">CGPA must be between 0.00 and 10.00.</p>
                </div>

                <div class="col-md-6">
                    <label for="academic_performance" class="form-label"><b>UG CGPA (Out of 10):</b></label>
                    <!-- MODIFIED: Added value="{{ user_inputs.academic_performance }}" -->
                    <input type="number" step="0.01" name="academic_performance" id="ug-cgpa" class="form-control" placeholder="e.g., 8" required value="{{ user_inputs.academic_performance }}">
                    <p id="ug-cgpa-error" style="color: red; display: none; margin-top: 5px;">UG CGPA must be between 0.00 and 10.00.</p>
                </div>
                
                

            <div class="col-md-6">
                <label for="communication_skills" class="form-label">
                <b>Communication Skills (Rate 1â€“10):</b>
                </label>

                <input type="number" name="communication_skills"
                class="form-control" min="1" max="10"
                placeholder="e.g., 7" required
                value="{{ user_inputs.communication_skills }}">

            <!-- Link to open full guide -->
                <small class="text-primary" style="cursor:pointer"
                data-bs-toggle="modal" data-bs-target="#commGuideModal">
                Rating Guide â“˜
                </small>
            </div>

            <div class="col-md-6">
                    <label for="internship_experience" class="form-label"><b>Do you have Internship Experience?</b></label>
                    <!-- MODIFIED: Added logic to select the correct option -->
                    <select name="internship_experience" class="form-select" required>
                        <option value="No" {% if user_inputs.internship_experience == 'No' %}selected{% endif %}>No</option>
                        <option value="Yes" {% if user_inputs.internship_experience == 'Yes' %}selected{% endif %}>Yes</option>
                    </select>
                </div>

                <div class="col-12">
                    <label for="projects_completed" class="form-label"><b>Number of Projects Completed:</b></label>
                    <!-- MODIFIED: Added value="{{ user_inputs.projects_completed }}" -->
                    <input type="number" name="projects_completed" class="form-control" min="0" placeholder="e.g., 3" required value="{{ user_inputs.projects_completed }}">
                </div>
            </div>
            <button type="submit" class="btn btn-primary w-100 mt-4 py-2">Predict My Chances</button>
        </form>

        {% if error_message %}
            <div class="result-box mt-4 alert alert-danger">
                <p class="prediction-text">Error: {{ error_message }}</p>
            </div>
        {% elif prediction %}
            <div class="result-box mt-4 {% if prob_placed >= 0.5 %}alert-success-custom{% else %}alert-warning-custom{% endif %}">
                <p class="prediction-text">{{ prediction }}</p>
                
                {% if recommendations %}
                    <hr>
                    <div class="recommendations">
                        <p class="mb-1"><b>ðŸ’¡ Here are some suggestions for you:</b></p>
                        <ul>
                            {% for item in recommendations %}
                                <li>{{ item|safe }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>

<!-- JavaScript for real-time CGPA validation -->
<script>
const cgpaInput = document.getElementById('cgpa-input');
const cgpaError = document.getElementById('cgpa-error');

const ugCgpaInput = document.getElementsByName('academic_performance')[0];
const ugCgpaError = document.getElementById('ug-cgpa-error');

const form = document.querySelector('form');

// Validate PG CGPA input on input event
cgpaInput.addEventListener('input', function() {
    const value = parseFloat(cgpaInput.value);
    if (isNaN(value) || value < 0 || value > 10) {
        cgpaError.style.display = 'block';
    } else {
        cgpaError.style.display = 'none';
    }
});

// Validate UG CGPA input on input event
ugCgpaInput.addEventListener('input', function() {
    const value = parseFloat(ugCgpaInput.value);
    if (isNaN(value) || value < 0 || value > 10) {
        ugCgpaError.style.display = 'block';
    } else {
        ugCgpaError.style.display = 'none';
    }
});

// Validate both inputs on form submission
form.addEventListener('submit', function(event) {
    const pgValue = parseFloat(cgpaInput.value);
    const ugValue = parseFloat(ugCgpaInput.value);
    let valid = true;

    if (isNaN(pgValue) || pgValue < 0 || pgValue > 10) {
        cgpaError.style.display = 'block';
        valid = false;
    }

    if (isNaN(ugValue) || ugValue < 0 || ugValue > 10) {
        ugCgpaError.style.display = 'block';
        valid = false;
    }

    if (!valid) {
        event.preventDefault();
        alert('Please correct the CGPA values before submitting.');
    }
});

</script>


<!-- Communication rating guide modal -->
<div class="modal fade" id="commGuideModal" tabindex="-1" aria-labelledby="commGuideLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="commGuideLabel">Communication Rating Guide (1â€“10)</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body small">
        <p><b>1:</b> <b>Cannot speak in English at all;</b> unable to answer even very simple questions.</p>
        <p><b>2:</b> <b>Very poor;</b> can say a few words but cannot make full sentences or maintain a basic conversation.</p>
        <p><b>3:</b> <b>Poor;</b> can answer simple questions with single words or short phrases, but others struggle to understand.</p>
        <p><b>4:</b> <b>Below average;</b> can speak in simple sentences about familiar topics but with many pauses and grammar mistakes.</p>
        <p><b>5:</b> <b>Average;</b> can explain basic ideas (like course, hometown, hobbies) but sometimes gets stuck or needs to repeat.</p>
        <p><b>6:</b> <b>Fair;</b> can describe projects and experiences in simple, clear language, but fluency and vocabulary are limited.</p>
        <p><b>7:</b> <b>Good;</b> usually speaks clearly and in complete sentences, maintains eye contact, and can handle common interview questions.</p>
        <p><b>8:</b> <b>Very good;</b> speaks confidently with good grammar and vocabulary, organizes answers well, and adapts to the listener.</p>
        <p><b>9:</b> <b>Excellent;</b> fluent, clear, and engaging speaker who can explain complex topics and respond to unexpected questions smoothly.</p>
        <p><b>10:</b> <b>Outstanding;</b> nearâ€‘professional level of communication, leads discussions or presentations with strong impact and almost no noticeable errors.</p>
      </div>
    </div>
  </div>
</div>


{% endblock %}